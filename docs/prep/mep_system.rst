.. _mep_system:

3. Prepare the membrane-embedded protein (MEP) system.
=======================================================

3.1. Creating the MEP system using CHARMM-GUI.
-----------------------------------------------

Prepare the membrane-embedded protein system using `CHARMM-GUI <https://www.charmm-gui.org/>`_, making sure that the protein is correctly placed in the membrane. Use only POPC for the membrane for a simple yet effective membrane. While the lipid is characterized in AMBER, it should be no problem to use a more complex membrane (i.e., add cholesterol).

Remember to align the protein to the Z axis and use the AMBER FF. The membrane must be parametrized with AMBER for a better reliability with GAFF2, with which the small molecules are parametrized

Use only the *gromacs* folder of the output generated by CHARMM-GUI. Rename the following files provided by CHARMM-GUI:

1. ``step5_input.gro`` --> ``system.gro``
2. ``topol.top`` --> ``system.top``

The proteins folder should contain at least the following files per protein (prot1, prot2, etc):

.. code-block:: text

    proteins
      |  |
      |  |-- prot1
      |  |    |
      |  |    |-- toppar
      |  |    |-- system.gro
      |  |    |-- system.top
      |  |
      |  |-- prot2
      |  |    |
      |  |    |-- toppar
      |  |    |-- system.gro
      |  |    |-- system.top
      |  |
      |  |-- ...


3.2. Using a different method.
--------------------------------

NEMAT searches for the files ``system.top`` (which references files inside the ``toppar`` folder), ``system.gro``, and the folder ``toppar``. Therefore, any set of files following this structure is a valid input for NEMAT. 

.. note::

   Actually, you could just change a force field folderâ€™s name to ``toppar`` 
   and update the ``#include`` inside the topology file. This would still 
   provide a valid input for NEMAT.

If you are using a custom force field, it is recommended to use the same for the membrane system. 



